#!/bin/bash
# ç®€æ´çš„è®°å¿†ä¿å­˜å‘½ä»¤
# ä½¿ç”¨æ–¹æ³•: memory-remember "æ ‡é¢˜" "å†…å®¹" [ç±»å‹] [é‡è¦æ€§] [æ ‡ç­¾...]

cd "/root/code/claude-memory-system"
source .venv/bin/activate

TITLE="$1"
CONTENT="$2"
MEMORY_TYPE="${3:-semantic}"
IMPORTANCE="${4:-5.0}"
shift 4
TAGS=("$@")

if [ -z "$TITLE" ] || [ -z "$CONTENT" ]; then
    echo "âŒ ç”¨æ³•: memory-remember \"æ ‡é¢˜\" \"å†…å®¹\" [ç±»å‹] [é‡è¦æ€§] [æ ‡ç­¾...]"
    echo "ç±»å‹: semantic|episodic|procedural|working (é»˜è®¤:semantic)"
    echo "é‡è¦æ€§: 1-10 (é»˜è®¤:5.0)"
    echo "ç¤ºä¾‹: memory-remember \"Pythonä¼˜åŒ–\" \"ä½¿ç”¨ç¼“å­˜æå‡æ€§èƒ½\" semantic 8.0 Python æ€§èƒ½"
    exit 1
fi

# å°†æ ‡ç­¾å†™å…¥ä¸´æ—¶æ–‡ä»¶
TEMP_TAGS_FILE="/tmp/memory_tags_$$"
printf "%s\n" "${TAGS[@]}" > "$TEMP_TAGS_FILE"

python3 -c "
import sys
sys.path.insert(0, '.')
from claude_memory import MemoryManager
from claude_memory.models.memory import MemoryType
from pathlib import Path

try:
    memory = MemoryManager(Path('..'))
    
    # è¯»å–æ ‡ç­¾
    tags = []
    try:
        with open('$TEMP_TAGS_FILE', 'r', encoding='utf-8') as f:
            tags = [line.strip() for line in f if line.strip()]
    except:
        tags = []
    
    memory_id = memory.remember(
        content='$CONTENT',
        title='$TITLE',
        memory_type=MemoryType('$MEMORY_TYPE'),
        importance=float('$IMPORTANCE'),
        tags=tags
    )
    
    print('âœ… è®°å¿†ä¿å­˜æˆåŠŸ!')
    print(f'ğŸ“ æ ‡é¢˜: $TITLE')
    print(f'ğŸ“„ å†…å®¹: $CONTENT')
    print(f'ğŸ·ï¸ ç±»å‹: $MEMORY_TYPE')
    print(f'â­ é‡è¦æ€§: $IMPORTANCE/10')
    if tags:
        print(f'ğŸ”– æ ‡ç­¾: {\"ã€\".join(tags)}')
    print(f'ğŸ†” è®°å¿†ID: {memory_id[:8]}...')
    
except Exception as e:
    print(f'âŒ ä¿å­˜å¤±è´¥: {e}')
    exit(1)
finally:
    import os
    try:
        os.remove('$TEMP_TAGS_FILE')
    except:
        pass
"