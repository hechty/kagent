#!/bin/bash
# ç®€æ´çš„è®°å¿†æœç´¢å‘½ä»¤
# ä½¿ç”¨æ–¹æ³•: memory-recall "æœç´¢å…³é”®è¯" [--max-results N] [--min-relevance N]

cd "/root/code/claude-memory-system"
source .venv/bin/activate

QUERY=""
MAX_RESULTS=3
MIN_RELEVANCE=0.1

# Parse arguments
while [[ $# -gt 0 ]]; do
    case $1 in
        --max-results)
            MAX_RESULTS="$2"
            shift 2
            ;;
        --min-relevance)
            MIN_RELEVANCE="$2"
            shift 2
            ;;
        *)
            if [ -z "$QUERY" ]; then
                QUERY="$1"
            fi
            shift
            ;;
    esac
done

if [ -z "$QUERY" ]; then
    echo "âŒ ç”¨æ³•: memory-recall \"æœç´¢å…³é”®è¯\" [--max-results N] [--min-relevance N]"
    echo "ç¤ºä¾‹: memory-recall \"Pythonæ€§èƒ½ä¼˜åŒ–\" --max-results 3 --min-relevance 0.1"
    exit 1
fi

python3 -c "
import sys
sys.path.insert(0, '.')
from claude_memory import MemoryManager
from pathlib import Path

try:
    memory = MemoryManager(Path('..'))
    results = memory.recall('''$QUERY''', max_results=$MAX_RESULTS, min_relevance=$MIN_RELEVANCE)
    
    if results:
        print(f'ğŸ” æ‰¾åˆ° {len(results)} ä¸ªç›¸å…³è®°å¿†:')
        print()
        for i, result in enumerate(results, 1):
            memory = result.memory
            print(f'{i}. ğŸ“ {memory.title}')
            print(f'   å†…å®¹: {memory.content[:150]}...' if len(memory.content) > 150 else f'   å†…å®¹: {memory.content}')
            print(f'   ç±»å‹: {memory.memory_type.value} | é‡è¦æ€§: {memory.importance}/10')
            print(f'   ç›¸å…³æ€§: {result.relevance_score:.3f}')
            if memory.tags:
                print(f'   æ ‡ç­¾: {\"ã€\".join(memory.tags)}')
            print()
    else:
        print('âŒ æœªæ‰¾åˆ°ç›¸å…³è®°å¿†')
        
except Exception as e:
    print(f'âŒ æœç´¢å¤±è´¥: {e}')
    exit(1)
"